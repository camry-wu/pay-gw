@import controllers.conf.ConfController._
@import helper._

@main {

@navbar(4)

<div class="container">

    <!-- Docs nav
    ================================================== -->
	<div class="row">
		<div class="span3 bs-docs-sidebar">
			<ul class="nav nav-list bs-docs-sidenav">
				<li><a href="/conf/bizChannelMgr"><i class="icon-chevron-right"></i>支付渠道</a></li>
				<li><a href="/conf/announcementMgr"><i class="icon-chevron-right"></i>公告管理</a></li>
			</ul>
		</div>

		<div class="span9">
			<!-- Tables
			================================================== -->
			<section id="channelConf">
				<div class="page-header">
					<h1>公告管理</h1>
				</div>
				<div class="panel panel-default">
					<div class="panel-heading">
						查询条件
					</div>
					<div class="panel-body">
						<button id="newAnnouncementBtn" class="btn" data-toggle="modal" data-target="#annModal">Create</button>
					</div>
				</div>
				<div id="toolbar" class="input-append">
					<input id="keyword" type="text" class="span2" placeholder="Keyword">
					<button id="searchAnnouncementBtn" class="btn" type="button">Search</button>
				</div>
				<table id="table"></table>
			</section>

		</div>
	</div>
</div>
<div class="modal fade" id="annModal" tabindex="-1" role="dialog" aria-labelledby="annModalLabel" aria-hidden="true">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal" aria-hidden="true">
					&times;
				</button>
				<h4 class="modal-title" id="annModalLabel">
					新建公告
				</h4>
			</div>
			<div class="modal-body">
				@helper.form(action = controllers.conf.routes.ConfController.newAnnouncement()) {
					@helper.inputText(announcementForm("annType"))
					@helper.inputText(announcementForm("content"))
					@helper.inputText(announcementForm("startTime"))
					@helper.inputText(announcementForm("endTime"))
				}
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
				<button type="button" class="btn btn-primary">保存</button>
			</div>
		</div><!-- /.modal-content -->
	</div><!-- /.modal -->
</div>

	} {
<script language="javascript">
function queryChannelParams(params) {
	var a = params;
	a.keyword = $("#keyword").val();
	return a;
}

$('#searchAnnouncementBtn').on('click', function() {
	$("#table").bootstrapTable('refresh');
});

$('#table').bootstrapTable({
	url: '/conf/announcement/list',
	dataType: "json",
	method: "GET",
	toolbar: "#toolbar",
	detailView: true,
	cache: false,
	//singleSelect: false,
	//locale: "zh-CN",
	//search: true,
	pagination: true,
	paginationLoop: true,
	pageNumber: 1,
	pageSize: 10,
	pageList: [10, 25, 50, 100],
	queryParams: queryChannelParams,
	queryParamsType: "limit",
	sidePagination: "server",
	columns: [{
		field: 'channelId',
		title: 'ID'
	}, {
		field: 'channelName',
		title: 'Name'
	}, {
		field: 'lastModify',
		title: '最后更新'
	}, {
		field: 'insertTime',
		title: '创建时间'
	}],

	// 注册加载子表的事件
	onExpandRow: function (index, row, $detail) {
		showPaymethodConf(index, row, $detail);
	}
});

function showPaymethodConf(index, row, $detail) {
	var channelId = row.oid;
	var key = row.secretKey;
	$detail.html(channelId + "<br/>" + key + "<br/>");
}
</script>
	}
